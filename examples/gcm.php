<?php
namespace Crypto;

$gcm_key = pack(
	"C*",
	0xee,0xbc,0x1f,0x57,0x48,0x7f,0x51,0x92,0x1c,0x04,0x65,0x66,
	0x5f,0x8a,0xe6,0xd1,0x65,0x8b,0xb2,0x6d,0xe6,0xf8,0xa0,0x69,
	0xa3,0x52,0x02,0x93,0xa5,0x72,0x07,0x8f
);
$gcm_iv = pack(
	"C*",
	0x99,0xaa,0x3e,0x68,0xed,0x81,0x73,0xa0,0xee,0xd0,0x66,0x84
);
$gcm_pt = pack(
	"C*",
	0xf5,0x6e,0x87,0x05,0x5b,0xc3,0x2d,0x0e,0xeb,0x31,0xb2,0xea,
	0xcc,0x2b,0xf2,0xa5
);
$gcm_aad = pack(
	"C*",
	0x4d,0x23,0xc3,0xce,0xc3,0x34,0xb4,0x9b,0xdb,0x37,0x0c,0x43,
	0x7f,0xec,0x78,0xde
);
$gcm_ct = pack(
	"C*",
	0xf7,0x26,0x44,0x13,0xa8,0x4c,0x0e,0x7c,0xd5,0x36,0x86,0x7e,
	0xb9,0xf2,0x17,0x36
);
$gcm_tag = pack(
	"C*",
	0x67,0xba,0x05,0x10,0x26,0x2a,0xe4,0x87,0xd7,0x37,0xee,0x62,
	0x98,0xf7,0x7e,0x0c
);


// ENCRYPTION 
echo "------- ENCRYPTION -------" . PHP_EOL;
echo "Plaintext: " . bin2hex($gcm_pt) . PHP_EOL;
$cipher = Cipher::aes(Cipher::MODE_GCM, 256);
$cipher->setAAD($gcm_aad);
$cipher->encryptInit($gcm_key, $gcm_iv);
$ct = $cipher->encryptUpdate($gcm_pt) . $cipher->encryptFinish();
echo "Ciphertext: " . bin2hex($ct) . PHP_EOL;
$tag = $cipher->getTag(strlen($gcm_tag));
echo "Tag: " . bin2hex($tag) . PHP_EOL;

echo PHP_EOL;
echo "------- DECRYPTION -------\n";
echo "Ciphertext: " . bin2hex($gcm_ct) . PHP_EOL;
$cipher = Cipher::aes(Cipher::MODE_GCM, 256);
$cipher->setTag($gcm_tag);
$cipher->setAAD($gcm_aad);
$cipher->decryptInit($gcm_key, $gcm_iv);
$pt = $cipher->decryptUpdate($gcm_ct) . $cipher->decryptFinish();
echo "Plaintext: " . bin2hex($pt) . PHP_EOL;
